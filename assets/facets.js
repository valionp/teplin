/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => {
  // webpackBootstrap
  /******/ var __webpack_modules__ = {
    /***/ "./src/js/components/facets.js":
      /*!*************************************!*\
  !*** ./src/js/components/facets.js ***!
  \*************************************/
      /***/ () => {
        eval(
          "class FacetFiltersForm extends HTMLElement {\n  constructor() {\n    super();\n    this.onActiveFilterClick = this.onActiveFilterClick.bind(this);\n\n    this.debouncedOnSubmit = debounce((event) => {\n      this.onSubmitHandler(event);\n    }, 500);\n\n    const facetForm = this.querySelector('form');\n    facetForm.addEventListener('input', this.debouncedOnSubmit.bind(this));\n\n    const facetWrapper = this.querySelector('#FacetsWrapperDesktop');\n    if (facetWrapper) facetWrapper.addEventListener('keyup', onKeyUpEscape);\n  }\n\n  static setListeners() {\n    const onHistoryChange = (event) => {\n      const searchParams = event.state ? event.state.searchParams : FacetFiltersForm.searchParamsInitial;\n      if (searchParams === FacetFiltersForm.searchParamsPrev) return;\n      FacetFiltersForm.renderPage(searchParams, null, false);\n    };\n    window.addEventListener('popstate', onHistoryChange);\n  }\n\n  static toggleActiveFacets(disable = true) {\n    document.querySelectorAll('.js-facet-remove').forEach((element) => {\n      element.classList.toggle('disabled', disable);\n    });\n  }\n\n  static renderPage(searchParams, event, updateURLHash = true) {\n    FacetFiltersForm.searchParamsPrev = searchParams;\n    const sections = FacetFiltersForm.getSections();\n    const countContainer = document.getElementById('ProductCount');\n    const countContainerDesktop = document.getElementById('ProductCountDesktop');\n    const loadingSpinners = document.querySelectorAll(\n      '.facets-container .loading__spinner, facet-filters-form .loading__spinner'\n    );\n    loadingSpinners.forEach((spinner) => spinner.classList.remove('hidden'));\n    document.getElementById('ProductGridContainer').querySelector('.collection').classList.add('loading');\n    if (countContainer) {\n      countContainer.classList.add('loading');\n    }\n    if (countContainerDesktop) {\n      countContainerDesktop.classList.add('loading');\n    }\n\n    sections.forEach((section) => {\n      const url = `${window.location.pathname}?section_id=${section.section}&${searchParams}`;\n      const filterDataUrl = (element) => element.url === url;\n\n      FacetFiltersForm.filterData.some(filterDataUrl)\n        ? FacetFiltersForm.renderSectionFromCache(filterDataUrl, event)\n        : FacetFiltersForm.renderSectionFromFetch(url, event);\n    });\n\n    if (updateURLHash) FacetFiltersForm.updateURLHash(searchParams);\n  }\n\n  static renderSectionFromFetch(url, event) {\n    fetch(url)\n      .then((response) => response.text())\n      .then((responseText) => {\n        const html = responseText;\n        FacetFiltersForm.filterData = [...FacetFiltersForm.filterData, { html, url }];\n        FacetFiltersForm.renderFilters(html, event);\n        FacetFiltersForm.renderProductGridContainer(html);\n        FacetFiltersForm.renderProductCount(html);\n        if (typeof initializeScrollAnimationTrigger === 'function') initializeScrollAnimationTrigger(html.innerHTML);\n      });\n  }\n\n  static renderSectionFromCache(filterDataUrl, event) {\n    const html = FacetFiltersForm.filterData.find(filterDataUrl).html;\n    FacetFiltersForm.renderFilters(html, event);\n    FacetFiltersForm.renderProductGridContainer(html);\n    FacetFiltersForm.renderProductCount(html);\n    if (typeof initializeScrollAnimationTrigger === 'function') initializeScrollAnimationTrigger(html.innerHTML);\n  }\n\n  static renderProductGridContainer(html) {\n    document.getElementById('ProductGridContainer').innerHTML = new DOMParser()\n      .parseFromString(html, 'text/html')\n      .getElementById('ProductGridContainer').innerHTML;\n\n    document\n      .getElementById('ProductGridContainer')\n      .querySelectorAll('.scroll-trigger')\n      .forEach((element) => {\n        element.classList.add('scroll-trigger--cancel');\n      });\n  }\n\n  static renderProductCount(html) {\n    const count = new DOMParser().parseFromString(html, 'text/html').getElementById('ProductCount').innerHTML;\n    const container = document.getElementById('ProductCount');\n    const containerDesktop = document.getElementById('ProductCountDesktop');\n    container.innerHTML = count;\n    container.classList.remove('loading');\n    if (containerDesktop) {\n      containerDesktop.innerHTML = count;\n      containerDesktop.classList.remove('loading');\n    }\n    const loadingSpinners = document.querySelectorAll(\n      '.facets-container .loading__spinner, facet-filters-form .loading__spinner'\n    );\n    loadingSpinners.forEach((spinner) => spinner.classList.add('hidden'));\n  }\n\n  static renderFilters(html, event) {\n    const parsedHTML = new DOMParser().parseFromString(html, 'text/html');\n    const facetDetailsElementsFromFetch = parsedHTML.querySelectorAll(\n      '#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter'\n    );\n    const facetDetailsElementsFromDom = document.querySelectorAll(\n      '#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter'\n    );\n\n    // Remove facets that are no longer returned from the server\n    Array.from(facetDetailsElementsFromDom).forEach((currentElement) => {\n      if (!Array.from(facetDetailsElementsFromFetch).some(({ id }) => currentElement.id === id)) {\n        currentElement.remove();\n      }\n    });\n\n    const matchesId = (element) => {\n      const jsFilter = event ? event.target.closest('.js-filter') : undefined;\n      return jsFilter ? element.id === jsFilter.id : false;\n    };\n    const facetsToRender = Array.from(facetDetailsElementsFromFetch).filter((element) => !matchesId(element));\n    const countsToRender = Array.from(facetDetailsElementsFromFetch).find(matchesId);\n\n    facetsToRender.forEach((elementToRender, index) => {\n      const currentElement = document.getElementById(elementToRender.id);\n      // Element already rendered in the DOM so just update the innerHTML\n      if (currentElement) {\n        document.getElementById(elementToRender.id).innerHTML = elementToRender.innerHTML;\n      } else {\n        if (index > 0) {\n          const { className: previousElementClassName, id: previousElementId } = facetsToRender[index - 1];\n          // Same facet type (eg horizontal/vertical or drawer/mobile)\n          if (elementToRender.className === previousElementClassName) {\n            document.getElementById(previousElementId).after(elementToRender);\n            return;\n          }\n        }\n\n        if (elementToRender.parentElement) {\n          document.querySelector(`#${elementToRender.parentElement.id} .js-filter`).before(elementToRender);\n        }\n      }\n    });\n\n    FacetFiltersForm.renderActiveFacets(parsedHTML);\n    FacetFiltersForm.renderAdditionalElements(parsedHTML);\n\n    if (countsToRender) {\n      const closestJSFilterID = event.target.closest('.js-filter').id;\n\n      if (closestJSFilterID) {\n        FacetFiltersForm.renderCounts(countsToRender, event.target.closest('.js-filter'));\n        FacetFiltersForm.renderMobileCounts(countsToRender, document.getElementById(closestJSFilterID));\n\n        const newFacetDetailsElement = document.getElementById(closestJSFilterID);\n        const newElementSelector = newFacetDetailsElement.classList.contains('mobile-facets__details')\n          ? `.mobile-facets__close-button`\n          : `.facets__summary`;\n        const newElementToActivate = newFacetDetailsElement.querySelector(newElementSelector);\n        if (newElementToActivate) newElementToActivate.focus();\n      }\n    }\n  }\n\n  static renderActiveFacets(html) {\n    const activeFacetElementSelectors = ['.active-facets-mobile', '.active-facets-desktop'];\n\n    activeFacetElementSelectors.forEach((selector) => {\n      const activeFacetsElement = html.querySelector(selector);\n      if (!activeFacetsElement) return;\n      document.querySelector(selector).innerHTML = activeFacetsElement.innerHTML;\n    });\n\n    FacetFiltersForm.toggleActiveFacets(false);\n  }\n\n  static renderAdditionalElements(html) {\n    const mobileElementSelectors = ['.mobile-facets__open', '.mobile-facets__count', '.sorting'];\n\n    mobileElementSelectors.forEach((selector) => {\n      if (!html.querySelector(selector)) return;\n      document.querySelector(selector).innerHTML = html.querySelector(selector).innerHTML;\n    });\n\n    document.getElementById('FacetFiltersFormMobile').closest('menu-drawer').bindEvents();\n  }\n\n  static renderCounts(source, target) {\n    const targetSummary = target.querySelector('.facets__summary');\n    const sourceSummary = source.querySelector('.facets__summary');\n\n    if (sourceSummary && targetSummary) {\n      targetSummary.outerHTML = sourceSummary.outerHTML;\n    }\n\n    const targetHeaderElement = target.querySelector('.facets__header');\n    const sourceHeaderElement = source.querySelector('.facets__header');\n\n    if (sourceHeaderElement && targetHeaderElement) {\n      targetHeaderElement.outerHTML = sourceHeaderElement.outerHTML;\n    }\n\n    const targetWrapElement = target.querySelector('.facets-wrap');\n    const sourceWrapElement = source.querySelector('.facets-wrap');\n\n    if (sourceWrapElement && targetWrapElement) {\n      const isShowingMore = Boolean(target.querySelector('show-more-button .label-show-more.hidden'));\n      if (isShowingMore) {\n        sourceWrapElement\n          .querySelectorAll('.facets__item.hidden')\n          .forEach((hiddenItem) => hiddenItem.classList.replace('hidden', 'show-more-item'));\n      }\n\n      targetWrapElement.outerHTML = sourceWrapElement.outerHTML;\n    }\n  }\n\n  static renderMobileCounts(source, target) {\n    const targetFacetsList = target.querySelector('.mobile-facets__list');\n    const sourceFacetsList = source.querySelector('.mobile-facets__list');\n\n    if (sourceFacetsList && targetFacetsList) {\n      targetFacetsList.outerHTML = sourceFacetsList.outerHTML;\n    }\n  }\n\n  static updateURLHash(searchParams) {\n    history.pushState({ searchParams }, '', `${window.location.pathname}${searchParams && '?'.concat(searchParams)}`);\n  }\n\n  static getSections() {\n    return [\n      {\n        section: document.getElementById('product-grid').dataset.id,\n      },\n    ];\n  }\n\n  createSearchParams(form) {\n    const formData = new FormData(form);\n    return new URLSearchParams(formData).toString();\n  }\n\n  onSubmitForm(searchParams, event) {\n    FacetFiltersForm.renderPage(searchParams, event);\n  }\n\n  onSubmitHandler(event) {\n    event.preventDefault();\n    const sortFilterForms = document.querySelectorAll('facet-filters-form form');\n    if (event.srcElement.className == 'mobile-facets__checkbox') {\n      const searchParams = this.createSearchParams(event.target.closest('form'));\n      this.onSubmitForm(searchParams, event);\n    } else {\n      const forms = [];\n      const isMobile = event.target.closest('form').id === 'FacetFiltersFormMobile';\n\n      sortFilterForms.forEach((form) => {\n        if (!isMobile) {\n          if (form.id === 'FacetSortForm' || form.id === 'FacetFiltersForm' || form.id === 'FacetSortDrawerForm') {\n            const noJsElements = document.querySelectorAll('.no-js-list');\n            noJsElements.forEach((el) => el.remove());\n            forms.push(this.createSearchParams(form));\n          }\n        } else if (form.id === 'FacetFiltersFormMobile') {\n          forms.push(this.createSearchParams(form));\n        }\n      });\n      this.onSubmitForm(forms.join('&'), event);\n    }\n  }\n\n  onActiveFilterClick(event) {\n    event.preventDefault();\n    FacetFiltersForm.toggleActiveFacets();\n    const url =\n      event.currentTarget.href.indexOf('?') == -1\n        ? ''\n        : event.currentTarget.href.slice(event.currentTarget.href.indexOf('?') + 1);\n    FacetFiltersForm.renderPage(url);\n  }\n}\n\nFacetFiltersForm.filterData = [];\nFacetFiltersForm.searchParamsInitial = window.location.search.slice(1);\nFacetFiltersForm.searchParamsPrev = window.location.search.slice(1);\ncustomElements.define('facet-filters-form', FacetFiltersForm);\nFacetFiltersForm.setListeners();\n\nclass PriceRange extends HTMLElement {\n  constructor() {\n    super();\n    this.querySelectorAll('input').forEach((element) =>\n      element.addEventListener('change', this.onRangeChange.bind(this))\n    );\n    this.setMinAndMaxValues();\n  }\n\n  onRangeChange(event) {\n    this.adjustToValidValues(event.currentTarget);\n    this.setMinAndMaxValues();\n  }\n\n  setMinAndMaxValues() {\n    const inputs = this.querySelectorAll('input');\n    const minInput = inputs[0];\n    const maxInput = inputs[1];\n    if (maxInput.value) minInput.setAttribute('max', maxInput.value);\n    if (minInput.value) maxInput.setAttribute('min', minInput.value);\n    if (minInput.value === '') maxInput.setAttribute('min', 0);\n    if (maxInput.value === '') minInput.setAttribute('max', maxInput.getAttribute('max'));\n  }\n\n  adjustToValidValues(input) {\n    const value = Number(input.value);\n    const min = Number(input.getAttribute('min'));\n    const max = Number(input.getAttribute('max'));\n\n    if (value < min) input.value = min;\n    if (value > max) input.value = max;\n  }\n}\n\ncustomElements.define('price-range', PriceRange);\n\nclass FacetRemove extends HTMLElement {\n  constructor() {\n    super();\n    const facetLink = this.querySelector('a');\n    facetLink.setAttribute('role', 'button');\n    facetLink.addEventListener('click', this.closeFilter.bind(this));\n    facetLink.addEventListener('keyup', (event) => {\n      event.preventDefault();\n      if (event.code.toUpperCase() === 'SPACE') this.closeFilter(event);\n    });\n  }\n\n  closeFilter(event) {\n    event.preventDefault();\n    const form = this.closest('facet-filters-form') || document.querySelector('facet-filters-form');\n    form.onActiveFilterClick(event);\n  }\n}\n\ncustomElements.define('facet-remove', FacetRemove);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvanMvY29tcG9uZW50cy9mYWNldHMuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sZWFybi13ZWJwYWNrLy4vc3JjL2pzL2NvbXBvbmVudHMvZmFjZXRzLmpzPzJmYmQiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRmFjZXRGaWx0ZXJzRm9ybSBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm9uQWN0aXZlRmlsdGVyQ2xpY2sgPSB0aGlzLm9uQWN0aXZlRmlsdGVyQ2xpY2suYmluZCh0aGlzKTtcblxuICAgIHRoaXMuZGVib3VuY2VkT25TdWJtaXQgPSBkZWJvdW5jZSgoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMub25TdWJtaXRIYW5kbGVyKGV2ZW50KTtcbiAgICB9LCA1MDApO1xuXG4gICAgY29uc3QgZmFjZXRGb3JtID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdmb3JtJyk7XG4gICAgZmFjZXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5kZWJvdW5jZWRPblN1Ym1pdC5iaW5kKHRoaXMpKTtcblxuICAgIGNvbnN0IGZhY2V0V3JhcHBlciA9IHRoaXMucXVlcnlTZWxlY3RvcignI0ZhY2V0c1dyYXBwZXJEZXNrdG9wJyk7XG4gICAgaWYgKGZhY2V0V3JhcHBlcikgZmFjZXRXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgb25LZXlVcEVzY2FwZSk7XG4gIH1cblxuICBzdGF0aWMgc2V0TGlzdGVuZXJzKCkge1xuICAgIGNvbnN0IG9uSGlzdG9yeUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gZXZlbnQuc3RhdGUgPyBldmVudC5zdGF0ZS5zZWFyY2hQYXJhbXMgOiBGYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc0luaXRpYWw7XG4gICAgICBpZiAoc2VhcmNoUGFyYW1zID09PSBGYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc1ByZXYpIHJldHVybjtcbiAgICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUGFnZShzZWFyY2hQYXJhbXMsIG51bGwsIGZhbHNlKTtcbiAgICB9O1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIG9uSGlzdG9yeUNoYW5nZSk7XG4gIH1cblxuICBzdGF0aWMgdG9nZ2xlQWN0aXZlRmFjZXRzKGRpc2FibGUgPSB0cnVlKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmpzLWZhY2V0LXJlbW92ZScpLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnZGlzYWJsZWQnLCBkaXNhYmxlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJQYWdlKHNlYXJjaFBhcmFtcywgZXZlbnQsIHVwZGF0ZVVSTEhhc2ggPSB0cnVlKSB7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5zZWFyY2hQYXJhbXNQcmV2ID0gc2VhcmNoUGFyYW1zO1xuICAgIGNvbnN0IHNlY3Rpb25zID0gRmFjZXRGaWx0ZXJzRm9ybS5nZXRTZWN0aW9ucygpO1xuICAgIGNvbnN0IGNvdW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RDb3VudCcpO1xuICAgIGNvbnN0IGNvdW50Q29udGFpbmVyRGVza3RvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0Q291bnREZXNrdG9wJyk7XG4gICAgY29uc3QgbG9hZGluZ1NwaW5uZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICcuZmFjZXRzLWNvbnRhaW5lciAubG9hZGluZ19fc3Bpbm5lciwgZmFjZXQtZmlsdGVycy1mb3JtIC5sb2FkaW5nX19zcGlubmVyJ1xuICAgICk7XG4gICAgbG9hZGluZ1NwaW5uZXJzLmZvckVhY2goKHNwaW5uZXIpID0+IHNwaW5uZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJykpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0R3JpZENvbnRhaW5lcicpLnF1ZXJ5U2VsZWN0b3IoJy5jb2xsZWN0aW9uJykuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgIGlmIChjb3VudENvbnRhaW5lcikge1xuICAgICAgY291bnRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgIH1cbiAgICBpZiAoY291bnRDb250YWluZXJEZXNrdG9wKSB7XG4gICAgICBjb3VudENvbnRhaW5lckRlc2t0b3AuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgIH1cblxuICAgIHNlY3Rpb25zLmZvckVhY2goKHNlY3Rpb24pID0+IHtcbiAgICAgIGNvbnN0IHVybCA9IGAke3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX0/c2VjdGlvbl9pZD0ke3NlY3Rpb24uc2VjdGlvbn0mJHtzZWFyY2hQYXJhbXN9YDtcbiAgICAgIGNvbnN0IGZpbHRlckRhdGFVcmwgPSAoZWxlbWVudCkgPT4gZWxlbWVudC51cmwgPT09IHVybDtcblxuICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5maWx0ZXJEYXRhLnNvbWUoZmlsdGVyRGF0YVVybClcbiAgICAgICAgPyBGYWNldEZpbHRlcnNGb3JtLnJlbmRlclNlY3Rpb25Gcm9tQ2FjaGUoZmlsdGVyRGF0YVVybCwgZXZlbnQpXG4gICAgICAgIDogRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJTZWN0aW9uRnJvbUZldGNoKHVybCwgZXZlbnQpO1xuICAgIH0pO1xuXG4gICAgaWYgKHVwZGF0ZVVSTEhhc2gpIEZhY2V0RmlsdGVyc0Zvcm0udXBkYXRlVVJMSGFzaChzZWFyY2hQYXJhbXMpO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclNlY3Rpb25Gcm9tRmV0Y2godXJsLCBldmVudCkge1xuICAgIGZldGNoKHVybClcbiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UudGV4dCgpKVxuICAgICAgLnRoZW4oKHJlc3BvbnNlVGV4dCkgPT4ge1xuICAgICAgICBjb25zdCBodG1sID0gcmVzcG9uc2VUZXh0O1xuICAgICAgICBGYWNldEZpbHRlcnNGb3JtLmZpbHRlckRhdGEgPSBbLi4uRmFjZXRGaWx0ZXJzRm9ybS5maWx0ZXJEYXRhLCB7IGh0bWwsIHVybCB9XTtcbiAgICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJGaWx0ZXJzKGh0bWwsIGV2ZW50KTtcbiAgICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJQcm9kdWN0R3JpZENvbnRhaW5lcihodG1sKTtcbiAgICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJQcm9kdWN0Q291bnQoaHRtbCk7XG4gICAgICAgIGlmICh0eXBlb2YgaW5pdGlhbGl6ZVNjcm9sbEFuaW1hdGlvblRyaWdnZXIgPT09ICdmdW5jdGlvbicpIGluaXRpYWxpemVTY3JvbGxBbmltYXRpb25UcmlnZ2VyKGh0bWwuaW5uZXJIVE1MKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclNlY3Rpb25Gcm9tQ2FjaGUoZmlsdGVyRGF0YVVybCwgZXZlbnQpIHtcbiAgICBjb25zdCBodG1sID0gRmFjZXRGaWx0ZXJzRm9ybS5maWx0ZXJEYXRhLmZpbmQoZmlsdGVyRGF0YVVybCkuaHRtbDtcbiAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlckZpbHRlcnMoaHRtbCwgZXZlbnQpO1xuICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUHJvZHVjdEdyaWRDb250YWluZXIoaHRtbCk7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJQcm9kdWN0Q291bnQoaHRtbCk7XG4gICAgaWYgKHR5cGVvZiBpbml0aWFsaXplU2Nyb2xsQW5pbWF0aW9uVHJpZ2dlciA9PT0gJ2Z1bmN0aW9uJykgaW5pdGlhbGl6ZVNjcm9sbEFuaW1hdGlvblRyaWdnZXIoaHRtbC5pbm5lckhUTUwpO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclByb2R1Y3RHcmlkQ29udGFpbmVyKGh0bWwpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnUHJvZHVjdEdyaWRDb250YWluZXInKS5pbm5lckhUTUwgPSBuZXcgRE9NUGFyc2VyKClcbiAgICAgIC5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpXG4gICAgICAuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RHcmlkQ29udGFpbmVyJykuaW5uZXJIVE1MO1xuXG4gICAgZG9jdW1lbnRcbiAgICAgIC5nZXRFbGVtZW50QnlJZCgnUHJvZHVjdEdyaWRDb250YWluZXInKVxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY3JvbGwtdHJpZ2dlcicpXG4gICAgICAuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Njcm9sbC10cmlnZ2VyLS1jYW5jZWwnKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclByb2R1Y3RDb3VudChodG1sKSB7XG4gICAgY29uc3QgY291bnQgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGh0bWwsICd0ZXh0L2h0bWwnKS5nZXRFbGVtZW50QnlJZCgnUHJvZHVjdENvdW50JykuaW5uZXJIVE1MO1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0Q291bnQnKTtcbiAgICBjb25zdCBjb250YWluZXJEZXNrdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RDb3VudERlc2t0b3AnKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gY291bnQ7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmcnKTtcbiAgICBpZiAoY29udGFpbmVyRGVza3RvcCkge1xuICAgICAgY29udGFpbmVyRGVza3RvcC5pbm5lckhUTUwgPSBjb3VudDtcbiAgICAgIGNvbnRhaW5lckRlc2t0b3AuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuICAgIH1cbiAgICBjb25zdCBsb2FkaW5nU3Bpbm5lcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgJy5mYWNldHMtY29udGFpbmVyIC5sb2FkaW5nX19zcGlubmVyLCBmYWNldC1maWx0ZXJzLWZvcm0gLmxvYWRpbmdfX3NwaW5uZXInXG4gICAgKTtcbiAgICBsb2FkaW5nU3Bpbm5lcnMuZm9yRWFjaCgoc3Bpbm5lcikgPT4gc3Bpbm5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7XG4gIH1cblxuICBzdGF0aWMgcmVuZGVyRmlsdGVycyhodG1sLCBldmVudCkge1xuICAgIGNvbnN0IHBhcnNlZEhUTUwgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGh0bWwsICd0ZXh0L2h0bWwnKTtcbiAgICBjb25zdCBmYWNldERldGFpbHNFbGVtZW50c0Zyb21GZXRjaCA9IHBhcnNlZEhUTUwucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICcjRmFjZXRGaWx0ZXJzRm9ybSAuanMtZmlsdGVyLCAjRmFjZXRGaWx0ZXJzRm9ybU1vYmlsZSAuanMtZmlsdGVyLCAjRmFjZXRGaWx0ZXJzUGlsbHNGb3JtIC5qcy1maWx0ZXInXG4gICAgKTtcbiAgICBjb25zdCBmYWNldERldGFpbHNFbGVtZW50c0Zyb21Eb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgJyNGYWNldEZpbHRlcnNGb3JtIC5qcy1maWx0ZXIsICNGYWNldEZpbHRlcnNGb3JtTW9iaWxlIC5qcy1maWx0ZXIsICNGYWNldEZpbHRlcnNQaWxsc0Zvcm0gLmpzLWZpbHRlcidcbiAgICApO1xuXG4gICAgLy8gUmVtb3ZlIGZhY2V0cyB0aGF0IGFyZSBubyBsb25nZXIgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyXG4gICAgQXJyYXkuZnJvbShmYWNldERldGFpbHNFbGVtZW50c0Zyb21Eb20pLmZvckVhY2goKGN1cnJlbnRFbGVtZW50KSA9PiB7XG4gICAgICBpZiAoIUFycmF5LmZyb20oZmFjZXREZXRhaWxzRWxlbWVudHNGcm9tRmV0Y2gpLnNvbWUoKHsgaWQgfSkgPT4gY3VycmVudEVsZW1lbnQuaWQgPT09IGlkKSkge1xuICAgICAgICBjdXJyZW50RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IG1hdGNoZXNJZCA9IChlbGVtZW50KSA9PiB7XG4gICAgICBjb25zdCBqc0ZpbHRlciA9IGV2ZW50ID8gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5qcy1maWx0ZXInKSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiBqc0ZpbHRlciA/IGVsZW1lbnQuaWQgPT09IGpzRmlsdGVyLmlkIDogZmFsc2U7XG4gICAgfTtcbiAgICBjb25zdCBmYWNldHNUb1JlbmRlciA9IEFycmF5LmZyb20oZmFjZXREZXRhaWxzRWxlbWVudHNGcm9tRmV0Y2gpLmZpbHRlcigoZWxlbWVudCkgPT4gIW1hdGNoZXNJZChlbGVtZW50KSk7XG4gICAgY29uc3QgY291bnRzVG9SZW5kZXIgPSBBcnJheS5mcm9tKGZhY2V0RGV0YWlsc0VsZW1lbnRzRnJvbUZldGNoKS5maW5kKG1hdGNoZXNJZCk7XG5cbiAgICBmYWNldHNUb1JlbmRlci5mb3JFYWNoKChlbGVtZW50VG9SZW5kZXIsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRUb1JlbmRlci5pZCk7XG4gICAgICAvLyBFbGVtZW50IGFscmVhZHkgcmVuZGVyZWQgaW4gdGhlIERPTSBzbyBqdXN0IHVwZGF0ZSB0aGUgaW5uZXJIVE1MXG4gICAgICBpZiAoY3VycmVudEVsZW1lbnQpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudFRvUmVuZGVyLmlkKS5pbm5lckhUTUwgPSBlbGVtZW50VG9SZW5kZXIuaW5uZXJIVE1MO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgIGNvbnN0IHsgY2xhc3NOYW1lOiBwcmV2aW91c0VsZW1lbnRDbGFzc05hbWUsIGlkOiBwcmV2aW91c0VsZW1lbnRJZCB9ID0gZmFjZXRzVG9SZW5kZXJbaW5kZXggLSAxXTtcbiAgICAgICAgICAvLyBTYW1lIGZhY2V0IHR5cGUgKGVnIGhvcml6b250YWwvdmVydGljYWwgb3IgZHJhd2VyL21vYmlsZSlcbiAgICAgICAgICBpZiAoZWxlbWVudFRvUmVuZGVyLmNsYXNzTmFtZSA9PT0gcHJldmlvdXNFbGVtZW50Q2xhc3NOYW1lKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcmV2aW91c0VsZW1lbnRJZCkuYWZ0ZXIoZWxlbWVudFRvUmVuZGVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZWxlbWVudFRvUmVuZGVyLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtlbGVtZW50VG9SZW5kZXIucGFyZW50RWxlbWVudC5pZH0gLmpzLWZpbHRlcmApLmJlZm9yZShlbGVtZW50VG9SZW5kZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlckFjdGl2ZUZhY2V0cyhwYXJzZWRIVE1MKTtcbiAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlckFkZGl0aW9uYWxFbGVtZW50cyhwYXJzZWRIVE1MKTtcblxuICAgIGlmIChjb3VudHNUb1JlbmRlcikge1xuICAgICAgY29uc3QgY2xvc2VzdEpTRmlsdGVySUQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmpzLWZpbHRlcicpLmlkO1xuXG4gICAgICBpZiAoY2xvc2VzdEpTRmlsdGVySUQpIHtcbiAgICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJDb3VudHMoY291bnRzVG9SZW5kZXIsIGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuanMtZmlsdGVyJykpO1xuICAgICAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlck1vYmlsZUNvdW50cyhjb3VudHNUb1JlbmRlciwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2xvc2VzdEpTRmlsdGVySUQpKTtcblxuICAgICAgICBjb25zdCBuZXdGYWNldERldGFpbHNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2xvc2VzdEpTRmlsdGVySUQpO1xuICAgICAgICBjb25zdCBuZXdFbGVtZW50U2VsZWN0b3IgPSBuZXdGYWNldERldGFpbHNFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnbW9iaWxlLWZhY2V0c19fZGV0YWlscycpXG4gICAgICAgICAgPyBgLm1vYmlsZS1mYWNldHNfX2Nsb3NlLWJ1dHRvbmBcbiAgICAgICAgICA6IGAuZmFjZXRzX19zdW1tYXJ5YDtcbiAgICAgICAgY29uc3QgbmV3RWxlbWVudFRvQWN0aXZhdGUgPSBuZXdGYWNldERldGFpbHNFbGVtZW50LnF1ZXJ5U2VsZWN0b3IobmV3RWxlbWVudFNlbGVjdG9yKTtcbiAgICAgICAgaWYgKG5ld0VsZW1lbnRUb0FjdGl2YXRlKSBuZXdFbGVtZW50VG9BY3RpdmF0ZS5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJBY3RpdmVGYWNldHMoaHRtbCkge1xuICAgIGNvbnN0IGFjdGl2ZUZhY2V0RWxlbWVudFNlbGVjdG9ycyA9IFsnLmFjdGl2ZS1mYWNldHMtbW9iaWxlJywgJy5hY3RpdmUtZmFjZXRzLWRlc2t0b3AnXTtcblxuICAgIGFjdGl2ZUZhY2V0RWxlbWVudFNlbGVjdG9ycy5mb3JFYWNoKChzZWxlY3RvcikgPT4ge1xuICAgICAgY29uc3QgYWN0aXZlRmFjZXRzRWxlbWVudCA9IGh0bWwucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICBpZiAoIWFjdGl2ZUZhY2V0c0VsZW1lbnQpIHJldHVybjtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLmlubmVySFRNTCA9IGFjdGl2ZUZhY2V0c0VsZW1lbnQuaW5uZXJIVE1MO1xuICAgIH0pO1xuXG4gICAgRmFjZXRGaWx0ZXJzRm9ybS50b2dnbGVBY3RpdmVGYWNldHMoZmFsc2UpO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlckFkZGl0aW9uYWxFbGVtZW50cyhodG1sKSB7XG4gICAgY29uc3QgbW9iaWxlRWxlbWVudFNlbGVjdG9ycyA9IFsnLm1vYmlsZS1mYWNldHNfX29wZW4nLCAnLm1vYmlsZS1mYWNldHNfX2NvdW50JywgJy5zb3J0aW5nJ107XG5cbiAgICBtb2JpbGVFbGVtZW50U2VsZWN0b3JzLmZvckVhY2goKHNlbGVjdG9yKSA9PiB7XG4gICAgICBpZiAoIWh0bWwucXVlcnlTZWxlY3RvcihzZWxlY3RvcikpIHJldHVybjtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLmlubmVySFRNTCA9IGh0bWwucXVlcnlTZWxlY3RvcihzZWxlY3RvcikuaW5uZXJIVE1MO1xuICAgIH0pO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ0ZhY2V0RmlsdGVyc0Zvcm1Nb2JpbGUnKS5jbG9zZXN0KCdtZW51LWRyYXdlcicpLmJpbmRFdmVudHMoKTtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJDb3VudHMoc291cmNlLCB0YXJnZXQpIHtcbiAgICBjb25zdCB0YXJnZXRTdW1tYXJ5ID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5mYWNldHNfX3N1bW1hcnknKTtcbiAgICBjb25zdCBzb3VyY2VTdW1tYXJ5ID0gc291cmNlLnF1ZXJ5U2VsZWN0b3IoJy5mYWNldHNfX3N1bW1hcnknKTtcblxuICAgIGlmIChzb3VyY2VTdW1tYXJ5ICYmIHRhcmdldFN1bW1hcnkpIHtcbiAgICAgIHRhcmdldFN1bW1hcnkub3V0ZXJIVE1MID0gc291cmNlU3VtbWFyeS5vdXRlckhUTUw7XG4gICAgfVxuXG4gICAgY29uc3QgdGFyZ2V0SGVhZGVyRWxlbWVudCA9IHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuZmFjZXRzX19oZWFkZXInKTtcbiAgICBjb25zdCBzb3VyY2VIZWFkZXJFbGVtZW50ID0gc291cmNlLnF1ZXJ5U2VsZWN0b3IoJy5mYWNldHNfX2hlYWRlcicpO1xuXG4gICAgaWYgKHNvdXJjZUhlYWRlckVsZW1lbnQgJiYgdGFyZ2V0SGVhZGVyRWxlbWVudCkge1xuICAgICAgdGFyZ2V0SGVhZGVyRWxlbWVudC5vdXRlckhUTUwgPSBzb3VyY2VIZWFkZXJFbGVtZW50Lm91dGVySFRNTDtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXRXcmFwRWxlbWVudCA9IHRhcmdldC5xdWVyeVNlbGVjdG9yKCcuZmFjZXRzLXdyYXAnKTtcbiAgICBjb25zdCBzb3VyY2VXcmFwRWxlbWVudCA9IHNvdXJjZS5xdWVyeVNlbGVjdG9yKCcuZmFjZXRzLXdyYXAnKTtcblxuICAgIGlmIChzb3VyY2VXcmFwRWxlbWVudCAmJiB0YXJnZXRXcmFwRWxlbWVudCkge1xuICAgICAgY29uc3QgaXNTaG93aW5nTW9yZSA9IEJvb2xlYW4odGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ3Nob3ctbW9yZS1idXR0b24gLmxhYmVsLXNob3ctbW9yZS5oaWRkZW4nKSk7XG4gICAgICBpZiAoaXNTaG93aW5nTW9yZSkge1xuICAgICAgICBzb3VyY2VXcmFwRWxlbWVudFxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCcuZmFjZXRzX19pdGVtLmhpZGRlbicpXG4gICAgICAgICAgLmZvckVhY2goKGhpZGRlbkl0ZW0pID0+IGhpZGRlbkl0ZW0uY2xhc3NMaXN0LnJlcGxhY2UoJ2hpZGRlbicsICdzaG93LW1vcmUtaXRlbScpKTtcbiAgICAgIH1cblxuICAgICAgdGFyZ2V0V3JhcEVsZW1lbnQub3V0ZXJIVE1MID0gc291cmNlV3JhcEVsZW1lbnQub3V0ZXJIVE1MO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJNb2JpbGVDb3VudHMoc291cmNlLCB0YXJnZXQpIHtcbiAgICBjb25zdCB0YXJnZXRGYWNldHNMaXN0ID0gdGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5tb2JpbGUtZmFjZXRzX19saXN0Jyk7XG4gICAgY29uc3Qgc291cmNlRmFjZXRzTGlzdCA9IHNvdXJjZS5xdWVyeVNlbGVjdG9yKCcubW9iaWxlLWZhY2V0c19fbGlzdCcpO1xuXG4gICAgaWYgKHNvdXJjZUZhY2V0c0xpc3QgJiYgdGFyZ2V0RmFjZXRzTGlzdCkge1xuICAgICAgdGFyZ2V0RmFjZXRzTGlzdC5vdXRlckhUTUwgPSBzb3VyY2VGYWNldHNMaXN0Lm91dGVySFRNTDtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgdXBkYXRlVVJMSGFzaChzZWFyY2hQYXJhbXMpIHtcbiAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7IHNlYXJjaFBhcmFtcyB9LCAnJywgYCR7d2luZG93LmxvY2F0aW9uLnBhdGhuYW1lfSR7c2VhcmNoUGFyYW1zICYmICc/Jy5jb25jYXQoc2VhcmNoUGFyYW1zKX1gKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRTZWN0aW9ucygpIHtcbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBzZWN0aW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZHVjdC1ncmlkJykuZGF0YXNldC5pZCxcbiAgICAgIH0sXG4gICAgXTtcbiAgfVxuXG4gIGNyZWF0ZVNlYXJjaFBhcmFtcyhmb3JtKSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG4gICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXMoZm9ybURhdGEpLnRvU3RyaW5nKCk7XG4gIH1cblxuICBvblN1Ym1pdEZvcm0oc2VhcmNoUGFyYW1zLCBldmVudCkge1xuICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUGFnZShzZWFyY2hQYXJhbXMsIGV2ZW50KTtcbiAgfVxuXG4gIG9uU3VibWl0SGFuZGxlcihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3Qgc29ydEZpbHRlckZvcm1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZmFjZXQtZmlsdGVycy1mb3JtIGZvcm0nKTtcbiAgICBpZiAoZXZlbnQuc3JjRWxlbWVudC5jbGFzc05hbWUgPT0gJ21vYmlsZS1mYWNldHNfX2NoZWNrYm94Jykge1xuICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gdGhpcy5jcmVhdGVTZWFyY2hQYXJhbXMoZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJ2Zvcm0nKSk7XG4gICAgICB0aGlzLm9uU3VibWl0Rm9ybShzZWFyY2hQYXJhbXMsIGV2ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZm9ybXMgPSBbXTtcbiAgICAgIGNvbnN0IGlzTW9iaWxlID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJ2Zvcm0nKS5pZCA9PT0gJ0ZhY2V0RmlsdGVyc0Zvcm1Nb2JpbGUnO1xuXG4gICAgICBzb3J0RmlsdGVyRm9ybXMuZm9yRWFjaCgoZm9ybSkgPT4ge1xuICAgICAgICBpZiAoIWlzTW9iaWxlKSB7XG4gICAgICAgICAgaWYgKGZvcm0uaWQgPT09ICdGYWNldFNvcnRGb3JtJyB8fCBmb3JtLmlkID09PSAnRmFjZXRGaWx0ZXJzRm9ybScgfHwgZm9ybS5pZCA9PT0gJ0ZhY2V0U29ydERyYXdlckZvcm0nKSB7XG4gICAgICAgICAgICBjb25zdCBub0pzRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubm8tanMtbGlzdCcpO1xuICAgICAgICAgICAgbm9Kc0VsZW1lbnRzLmZvckVhY2goKGVsKSA9PiBlbC5yZW1vdmUoKSk7XG4gICAgICAgICAgICBmb3Jtcy5wdXNoKHRoaXMuY3JlYXRlU2VhcmNoUGFyYW1zKGZvcm0pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZm9ybS5pZCA9PT0gJ0ZhY2V0RmlsdGVyc0Zvcm1Nb2JpbGUnKSB7XG4gICAgICAgICAgZm9ybXMucHVzaCh0aGlzLmNyZWF0ZVNlYXJjaFBhcmFtcyhmb3JtKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5vblN1Ym1pdEZvcm0oZm9ybXMuam9pbignJicpLCBldmVudCk7XG4gICAgfVxuICB9XG5cbiAgb25BY3RpdmVGaWx0ZXJDbGljayhldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS50b2dnbGVBY3RpdmVGYWNldHMoKTtcbiAgICBjb25zdCB1cmwgPVxuICAgICAgZXZlbnQuY3VycmVudFRhcmdldC5ocmVmLmluZGV4T2YoJz8nKSA9PSAtMVxuICAgICAgICA/ICcnXG4gICAgICAgIDogZXZlbnQuY3VycmVudFRhcmdldC5ocmVmLnNsaWNlKGV2ZW50LmN1cnJlbnRUYXJnZXQuaHJlZi5pbmRleE9mKCc/JykgKyAxKTtcbiAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlclBhZ2UodXJsKTtcbiAgfVxufVxuXG5GYWNldEZpbHRlcnNGb3JtLmZpbHRlckRhdGEgPSBbXTtcbkZhY2V0RmlsdGVyc0Zvcm0uc2VhcmNoUGFyYW1zSW5pdGlhbCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc2xpY2UoMSk7XG5GYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc1ByZXYgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpO1xuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdmYWNldC1maWx0ZXJzLWZvcm0nLCBGYWNldEZpbHRlcnNGb3JtKTtcbkZhY2V0RmlsdGVyc0Zvcm0uc2V0TGlzdGVuZXJzKCk7XG5cbmNsYXNzIFByaWNlUmFuZ2UgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goKGVsZW1lbnQpID0+XG4gICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25SYW5nZUNoYW5nZS5iaW5kKHRoaXMpKVxuICAgICk7XG4gICAgdGhpcy5zZXRNaW5BbmRNYXhWYWx1ZXMoKTtcbiAgfVxuXG4gIG9uUmFuZ2VDaGFuZ2UoZXZlbnQpIHtcbiAgICB0aGlzLmFkanVzdFRvVmFsaWRWYWx1ZXMoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5zZXRNaW5BbmRNYXhWYWx1ZXMoKTtcbiAgfVxuXG4gIHNldE1pbkFuZE1heFZhbHVlcygpIHtcbiAgICBjb25zdCBpbnB1dHMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0Jyk7XG4gICAgY29uc3QgbWluSW5wdXQgPSBpbnB1dHNbMF07XG4gICAgY29uc3QgbWF4SW5wdXQgPSBpbnB1dHNbMV07XG4gICAgaWYgKG1heElucHV0LnZhbHVlKSBtaW5JbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heElucHV0LnZhbHVlKTtcbiAgICBpZiAobWluSW5wdXQudmFsdWUpIG1heElucHV0LnNldEF0dHJpYnV0ZSgnbWluJywgbWluSW5wdXQudmFsdWUpO1xuICAgIGlmIChtaW5JbnB1dC52YWx1ZSA9PT0gJycpIG1heElucHV0LnNldEF0dHJpYnV0ZSgnbWluJywgMCk7XG4gICAgaWYgKG1heElucHV0LnZhbHVlID09PSAnJykgbWluSW5wdXQuc2V0QXR0cmlidXRlKCdtYXgnLCBtYXhJbnB1dC5nZXRBdHRyaWJ1dGUoJ21heCcpKTtcbiAgfVxuXG4gIGFkanVzdFRvVmFsaWRWYWx1ZXMoaW5wdXQpIHtcbiAgICBjb25zdCB2YWx1ZSA9IE51bWJlcihpbnB1dC52YWx1ZSk7XG4gICAgY29uc3QgbWluID0gTnVtYmVyKGlucHV0LmdldEF0dHJpYnV0ZSgnbWluJykpO1xuICAgIGNvbnN0IG1heCA9IE51bWJlcihpbnB1dC5nZXRBdHRyaWJ1dGUoJ21heCcpKTtcblxuICAgIGlmICh2YWx1ZSA8IG1pbikgaW5wdXQudmFsdWUgPSBtaW47XG4gICAgaWYgKHZhbHVlID4gbWF4KSBpbnB1dC52YWx1ZSA9IG1heDtcbiAgfVxufVxuXG5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ3ByaWNlLXJhbmdlJywgUHJpY2VSYW5nZSk7XG5cbmNsYXNzIEZhY2V0UmVtb3ZlIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIGNvbnN0IGZhY2V0TGluayA9IHRoaXMucXVlcnlTZWxlY3RvcignYScpO1xuICAgIGZhY2V0TGluay5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gICAgZmFjZXRMaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZUZpbHRlci5iaW5kKHRoaXMpKTtcbiAgICBmYWNldExpbmsuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoZXZlbnQuY29kZS50b1VwcGVyQ2FzZSgpID09PSAnU1BBQ0UnKSB0aGlzLmNsb3NlRmlsdGVyKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlRmlsdGVyKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBmb3JtID0gdGhpcy5jbG9zZXN0KCdmYWNldC1maWx0ZXJzLWZvcm0nKSB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmYWNldC1maWx0ZXJzLWZvcm0nKTtcbiAgICBmb3JtLm9uQWN0aXZlRmlsdGVyQ2xpY2soZXZlbnQpO1xuICB9XG59XG5cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnZmFjZXQtcmVtb3ZlJywgRmFjZXRSZW1vdmUpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/js/components/facets.js\n"
        );

        /***/
      },

    /******/
  };
  /************************************************************************/
  /******/
  /******/ // startup
  /******/ // Load entry module and return exports
  /******/ // This entry module can't be inlined because the eval-source-map devtool is used.
  /******/ var __webpack_exports__ = {};
  /******/ __webpack_modules__["./src/js/components/facets.js"]();
  /******/
  /******/
})();
